# 项目重置完成

## ✅ 已完成的工作

### 1. 清理临时功能
- ✅ 删除了所有实验性的数据管理器代码
- ✅ 删除了 `src/shared/cocos-utils.ts`（不必要的中间层）
- ✅ 只保留了基础框架结构

### 2. 简化平台 API
**三个平台实现现在只有基础框架：**

```typescript
// cocos.ts - Cocos 平台（通过 IPC 调用主进程）
export const cocosApi: IEditorApi = {
    platform: 'cocos-v2' | 'cocos-v3',
    // TODO: 根据需求添加方法
};

// electron.ts - Electron 平台
export const electronApi: IEditorApi = {
    platform: 'electron',
    // TODO: 根据需求添加方法
};

// standalone.ts - 浏览器平台
export const standaloneApi: IEditorApi = {
    platform: 'standalone',
    // TODO: 根据需求添加方法
};
```

### 3. 简化 App.vue
只保留了欢迎页面，显示当前运行平台。

### 4. 更正架构文档
解释了为什么 Vue 面板不能直接使用主进程的适配器工厂。

---

## 📐 架构理解

### 为什么不能在 cocos.ts 中直接使用适配器工厂？

```
问题：Vue 面板（iframe）无法访问 Node.js 模块

❌ 错误想法：
   Vue 面板 → 直接 import 适配器工厂 → 调用 Cocos API

✅ 正确方案：
   Vue 面板 → IPC 通信 → 主进程 → 适配器工厂 → Cocos API
```

**原因**：
1. `src/adapters/` 是 Node.js 模块（依赖主进程的 `Editor` 对象）
2. Vue 面板运行在 iframe 浏览器环境（无法 require Node.js 模块）
3. iframe 中的 `Editor` 对象是精简版，只有 IPC 通信功能

**解决方案**：
```typescript
// Vue 面板 (cocos.ts)
function sendToMain(method: string, ...args: any[]) {
    if (isV3) {
        return Editor.Message.request('cc-table-tool', method, ...args);
    } else {
        return Editor.Ipc.sendToMain('cc-table-tool:' + method, ...args);
    }
}

// 主进程 (src/main.ts)
export const messages = {
    'select-file': async (options) => {
        const editor = getEditor(); // 使用适配器工厂
        return editor.selectFile(options);
    }
};
```

---

## 🎯 下一步计划

### 1. 设计数据管理器功能需求
需要明确：
- 数据格式（JSON / 二进制 / 加密？）
- 文件操作（创建 / 打开 / 保存）
- 表格编辑（增删改查）
- 数据验证

### 2. 根据需求扩展 IEditorApi 接口
在 `src/panels/vue-editor/src/api/index.ts` 中添加方法定义。

### 3. 实现三个平台的具体实现
- **cocos.ts** → IPC 调用主进程
- **electron.ts** → Electron IPC
- **standalone.ts** → 浏览器 File System API

### 4. 开发 Vue 业务逻辑
在 `App.vue` 中实现数据编辑器的 UI 和交互。

---

## 🚀 测试命令

```bash
# 浏览器开发模式
npm run dev:editor

# 构建 Cocos 2.x 版本
npm run build:v2

# 构建 Cocos 3.x 版本
npm run build:v3

# 打包独立 exe
npm run build:exe
```

---

## 📝 文件结构（当前状态）

```
src/
├── index.ts                          # 框架导出（适配器工厂）
├── main.ts                           # 插件主进程入口
├── adapters/                         # v2/v3 适配器（主进程使用）
│   ├── v2/
│   └── v3/
└── panels/
    └── vue-editor/
        └── src/
            ├── App.vue               # 简化的欢迎页面
            ├── main.ts
            └── api/
                ├── index.ts          # 统一 API 接口定义
                ├── cocos.ts          # Cocos 平台（IPC 通信）
                ├── electron.ts       # Electron 平台
                └── standalone.ts     # 浏览器平台
```

---

## ✨ 核心优势

1. **职责清晰**：框架处理版本差异，业务关注功能实现
2. **渐进式开发**：从简单功能开始，逐步添加复杂特性
3. **跨平台统一**：同一套 Vue 代码在四种环境运行
4. **易于测试**：浏览器模式快速迭代，生产模式稳定运行
