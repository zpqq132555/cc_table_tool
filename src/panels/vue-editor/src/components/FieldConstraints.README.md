# é»˜è®¤å€¼è§„åˆ™ä¸å­—æ®µé…ç½®å®Œå–„è¯´æ˜

## ğŸ“‹ å®Œæˆçš„æ”¹è¿›

### 1. ç»Ÿä¸€çš„é»˜è®¤å€¼è·å–å‡½æ•° âœ…

åœ¨ [fieldFactory.ts](../utils/fieldFactory.ts) ä¸­æ–°å¢ `getDefaultValue()` å‡½æ•°ï¼Œç»Ÿä¸€å¤„ç†æ‰€æœ‰å­—æ®µç±»å‹çš„é»˜è®¤å€¼é€»è¾‘ã€‚

#### é»˜è®¤å€¼è§„åˆ™

| ç±»å‹ | é»˜è®¤å€¼è§„åˆ™ | è¯´æ˜ |
|------|-----------|------|
| **string** | å­—æ®µçš„ `defaultValue` æˆ– `''` | ä¼˜å…ˆä½¿ç”¨é…ç½®çš„é»˜è®¤å€¼ï¼Œå¦åˆ™ä¸ºç©ºå­—ç¬¦ä¸² |
| **number** | å­—æ®µçš„ `defaultValue` æˆ– `0` | ä¼˜å…ˆä½¿ç”¨é…ç½®çš„é»˜è®¤å€¼ï¼Œå¦åˆ™ä¸º 0 |
| **boolean** | å­—æ®µçš„ `defaultValue` æˆ– `false` | ä¼˜å…ˆä½¿ç”¨é…ç½®çš„é»˜è®¤å€¼ï¼Œå¦åˆ™ä¸º false |
| **select** | å­—æ®µçš„ `defaultValue` æˆ– `''` | ä¼˜å…ˆä½¿ç”¨é…ç½®çš„é»˜è®¤å€¼ï¼Œå¦åˆ™ä¸ºç©ºå­—ç¬¦ä¸² |
| **reward** | å­—æ®µçš„ `defaultValue` æˆ– `{ id: '', count: 0 }` | ä¼˜å…ˆä½¿ç”¨é…ç½®çš„é»˜è®¤å€¼ï¼ˆæ·±æ‹·è´ï¼‰ï¼Œå¦åˆ™ä¸ºç©ºå¥–åŠ±å¯¹è±¡ |
| **array** | æ ¹æ® `fixedLength` å†³å®š | è§ä¸‹æ–¹æ•°ç»„è§„åˆ™ |
| **object** | æ ¹æ® `properties` åˆå§‹åŒ– | é€’å½’åˆå§‹åŒ–æ‰€æœ‰å­å±æ€§ |

#### æ•°ç»„ç±»å‹ç‰¹æ®Šè§„åˆ™

```typescript
// å®šé•¿æ•°ç»„ï¼ˆfixedLength > 0ï¼‰
// æ ¹æ®å…ƒç´ ç±»å‹çš„é»˜è®¤å€¼åˆå§‹åŒ–æŒ‡å®šé•¿åº¦çš„æ•°ç»„
const fixedArray = [element_default, element_default, ...]; // length = fixedLength

// ä¸å®šé•¿æ•°ç»„ï¼ˆfixedLength = 0 æˆ–æœªè®¾ç½®ï¼‰
// åˆå§‹ä¸ºç©ºæ•°ç»„
const dynamicArray = [];

// æ·»åŠ å…ƒç´ æ—¶ï¼Œä½¿ç”¨å…ƒç´ ç±»å‹çš„é»˜è®¤å€¼
const newElement = getDefaultValue(arrayField.element);
```

#### å¯¹è±¡ç±»å‹ç‰¹æ®Šè§„åˆ™

```typescript
// æ ¹æ® properties å®šä¹‰é€’å½’åˆå§‹åŒ–
const obj = {
  prop1: getDefaultValue(prop1Field),
  prop2: getDefaultValue(prop2Field),
  ...
};
```

---

### 2. ç»„ä»¶ç»Ÿä¸€ä½¿ç”¨æ–°çš„é»˜è®¤å€¼å‡½æ•° âœ…

#### æ›´æ–°çš„ç»„ä»¶

1. **ArrayEditor.vue**
   - å¯¼å…¥ `getDefaultValue` å‡½æ•°
   - ç§»é™¤æœ¬åœ°çš„ `getDefaultValueByType` å®ç°
   - åˆå§‹åŒ–å›ºå®šé•¿åº¦æ•°ç»„æ—¶ä½¿ç”¨ç»Ÿä¸€å‡½æ•°
   - æ·»åŠ å…ƒç´ æ—¶ä½¿ç”¨ç»Ÿä¸€å‡½æ•°

2. **DataEditor.vue**
   - å¯¼å…¥ `getDefaultValue` å‡½æ•°
   - ç§»é™¤æœ¬åœ°çš„ `getDefaultValueByType` å®ç°
   - åˆ›å»ºé»˜è®¤æ•°æ®æ—¶ä½¿ç”¨ç»Ÿä¸€å‡½æ•°

---

### 3. å®Œå–„ FieldEditor çš„æ•°ç»„å…ƒç´ çº¦æŸé…ç½® âœ…

#### æ–°å¢åŠŸèƒ½ï¼šå…ƒç´ çº¦æŸé…ç½®ç•Œé¢

å½“æ•°ç»„å…ƒç´ ç±»å‹ä¸º**åŸºæœ¬ç±»å‹**æ—¶ï¼ˆé array/objectï¼‰ï¼Œç°åœ¨å¯ä»¥ç›´æ¥é…ç½®å…ƒç´ çš„çº¦æŸæ¡ä»¶ã€‚

#### æ”¯æŒçš„å…ƒç´ ç±»å‹çº¦æŸ

##### ğŸ“ æ•°å­—ç±»å‹å…ƒç´ 
```typescript
{
  defaultValue: number;  // é»˜è®¤å€¼
  min: number;          // æœ€å°å€¼
  max: number;          // æœ€å¤§å€¼
  step: number;         // æ­¥é•¿
}
```

**ç•Œé¢é…ç½®**ï¼š
- é»˜è®¤å€¼è¾“å…¥æ¡†
- æœ€å°å€¼è¾“å…¥æ¡†
- æœ€å¤§å€¼è¾“å…¥æ¡†
- æ­¥é•¿è¾“å…¥æ¡†

##### ğŸ“ æ–‡æœ¬ç±»å‹å…ƒç´ 
```typescript
{
  defaultValue: string;  // é»˜è®¤å€¼
  maxLength: number;     // æœ€å¤§é•¿åº¦
}
```

**ç•Œé¢é…ç½®**ï¼š
- é»˜è®¤å€¼è¾“å…¥æ¡†
- æœ€å¤§é•¿åº¦è¾“å…¥æ¡†

##### âœ… å¸ƒå°”ç±»å‹å…ƒç´ 
```typescript
{
  defaultValue: boolean;  // é»˜è®¤å€¼
}
```

**ç•Œé¢é…ç½®**ï¼š
- é»˜è®¤å¼€å¯å¤é€‰æ¡†

##### ğŸ“‹ ä¸‹æ‹‰ç±»å‹å…ƒç´ 
```typescript
{
  defaultValue: string | number;  // é»˜è®¤å€¼
  options: Array<{                // é€‰é¡¹åˆ—è¡¨
    label: string;
    value: string | number;
  }>;
}
```

**ç•Œé¢é…ç½®**ï¼š
- é»˜è®¤å€¼ä¸‹æ‹‰é€‰æ‹©
- é€‰é¡¹åˆ—è¡¨ç®¡ç†ï¼ˆæ·»åŠ /åˆ é™¤ï¼‰
- æ¯ä¸ªé€‰é¡¹åŒ…å«ï¼šæ˜¾ç¤ºæ–‡æœ¬ã€å®é™…å€¼

##### ğŸ å¥–åŠ±ç±»å‹å…ƒç´ 
```typescript
{
  defaultValue: {
    id: string;     // é»˜è®¤ID
    count: number;  // é»˜è®¤æ•°é‡
  };
}
```

**ç•Œé¢é…ç½®**ï¼š
- é»˜è®¤IDè¾“å…¥æ¡†
- é»˜è®¤æ•°é‡è¾“å…¥æ¡†

---

### 4. å®ç°ç»†èŠ‚

#### æ–°å¢çš„è¾…åŠ©å‡½æ•°

##### `resetElementConstraints()`
æ ¹æ®é€‰æ‹©çš„å…ƒç´ ç±»å‹ï¼Œé‡ç½®å…ƒç´ çº¦æŸä¸ºå¯¹åº”çš„é»˜è®¤ç»“æ„ã€‚

##### `addElementOption()` / `removeElementOption()`
ç®¡ç†ä¸‹æ‹‰ç±»å‹å…ƒç´ çš„é€‰é¡¹åˆ—è¡¨ã€‚

##### `applyElementConstraints(elementType, constraints)`
å°†å…ƒç´ çº¦æŸåº”ç”¨åˆ°å­—æ®µå®šä¹‰ä¸­ï¼Œè¿‡æ»¤æ‰æœªå®šä¹‰æˆ–ç©ºå€¼çš„å±æ€§ã€‚

#### åˆå§‹åŒ–é€»è¾‘æ”¹è¿›

ç¼–è¾‘å·²æœ‰æ•°ç»„å­—æ®µæ—¶ï¼Œä¼šæ­£ç¡®åŠ è½½å…ƒç´ çš„çº¦æŸé…ç½®ï¼š
- åŸºæœ¬ç±»å‹å…ƒç´ ï¼šåŠ è½½åˆ° `elementConstraints`
- å¤æ‚ç±»å‹å…ƒç´ ï¼šåŠ è½½åˆ° `element`

#### ä¿å­˜é€»è¾‘æ”¹è¿›

ä¿å­˜æ•°ç»„å­—æ®µæ—¶ï¼š
- åŸºæœ¬ç±»å‹å…ƒç´ ï¼šåº”ç”¨ `elementConstraints` åˆ°å…ƒç´ å®šä¹‰
- å¤æ‚ç±»å‹å…ƒç´ ï¼šä½¿ç”¨åµŒå¥—ç¼–è¾‘å™¨çš„å®Œæ•´å®šä¹‰

---

### 5. ç•Œé¢ä¼˜åŒ–

#### æ–°å¢æ ·å¼

```css
.config-subtitle         /* å­æ ‡é¢˜æ ·å¼ */
.element-constraints     /* å…ƒç´ çº¦æŸå®¹å™¨ */
.form-input-small        /* ç´§å‡‘è¾“å…¥æ¡† */
.options-list-compact    /* ç´§å‡‘é€‰é¡¹åˆ—è¡¨ */
```

#### è§†è§‰å±‚æ¬¡

```
æ•°ç»„é…ç½®
â”œâ”€ å›ºå®šé•¿åº¦
â”œâ”€ å…ƒç´ ç±»å‹
â””â”€ å…ƒç´ çº¦æŸ â† æ–°å¢åŒºåŸŸï¼ˆç»¿è‰²è¾¹æ¡†é«˜äº®ï¼‰
   â”œâ”€ é…ç½®æ ‡é¢˜
   â””â”€ ç±»å‹ç‰¹å®šé…ç½®é¡¹
```

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šæ•°å­—æ•°ç»„ï¼ˆ0-100ï¼Œæ­¥é•¿5ï¼‰

```typescript
{
  key: 'scores',
  name: 'åˆ†æ•°åˆ—è¡¨',
  type: 'array',
  fixedLength: 0,  // ä¸å®šé•¿
  element: {
    type: 'number',
    key: 'score',
    name: 'åˆ†æ•°',
    defaultValue: 60,
    min: 0,
    max: 100,
    step: 5
  }
}
```

**é…ç½®æ­¥éª¤**ï¼š
1. é€‰æ‹©å­—æ®µç±»å‹ï¼šæ•°ç»„
2. è®¾ç½®å›ºå®šé•¿åº¦ï¼š0ï¼ˆä¸å®šé•¿ï¼‰
3. é€‰æ‹©å…ƒç´ ç±»å‹ï¼šæ•°å­—
4. åœ¨"å…ƒç´ çº¦æŸ"åŒºåŸŸé…ç½®ï¼š
   - é»˜è®¤å€¼ï¼š60
   - æœ€å°å€¼ï¼š0
   - æœ€å¤§å€¼ï¼š100
   - æ­¥é•¿ï¼š5

### ç¤ºä¾‹ 2ï¼šä¸‹æ‹‰é€‰é¡¹æ•°ç»„

```typescript
{
  key: 'tags',
  name: 'æ ‡ç­¾åˆ—è¡¨',
  type: 'array',
  fixedLength: 0,
  element: {
    type: 'select',
    key: 'tag',
    name: 'æ ‡ç­¾',
    defaultValue: 'common',
    options: [
      { label: 'æ™®é€š', value: 'common' },
      { label: 'ç¨€æœ‰', value: 'rare' },
      { label: 'å²è¯—', value: 'epic' }
    ]
  }
}
```

**é…ç½®æ­¥éª¤**ï¼š
1. é€‰æ‹©å­—æ®µç±»å‹ï¼šæ•°ç»„
2. è®¾ç½®å›ºå®šé•¿åº¦ï¼š0
3. é€‰æ‹©å…ƒç´ ç±»å‹ï¼šä¸‹æ‹‰
4. åœ¨"å…ƒç´ çº¦æŸ"åŒºåŸŸï¼š
   - ç‚¹å‡»"â• æ·»åŠ é€‰é¡¹"
   - æ·»åŠ  3 ä¸ªé€‰é¡¹
   - è®¾ç½®é»˜è®¤å€¼ï¼šcommon

### ç¤ºä¾‹ 3ï¼šå®šé•¿å¥–åŠ±æ•°ç»„

```typescript
{
  key: 'rewards',
  name: 'å¥–åŠ±åˆ—è¡¨ï¼ˆ3ä¸ªï¼‰',
  type: 'array',
  fixedLength: 3,  // å›ºå®š3ä¸ª
  element: {
    type: 'reward',
    key: 'reward',
    name: 'å¥–åŠ±',
    defaultValue: {
      id: 'gold',
      count: 100
    }
  }
}
```

**é…ç½®æ­¥éª¤**ï¼š
1. é€‰æ‹©å­—æ®µç±»å‹ï¼šæ•°ç»„
2. è®¾ç½®å›ºå®šé•¿åº¦ï¼š3
3. é€‰æ‹©å…ƒç´ ç±»å‹ï¼šå¥–åŠ±
4. åœ¨"å…ƒç´ çº¦æŸ"åŒºåŸŸé…ç½®ï¼š
   - é»˜è®¤IDï¼šgold
   - é»˜è®¤æ•°é‡ï¼š100

---

## âœ¨ æ”¹è¿›æ•ˆæœ

### ä¹‹å‰çš„é—®é¢˜
- âŒ æ•°ç»„å…ƒç´ æ— æ³•é…ç½®çº¦æŸï¼ˆå¦‚æ•°å­—èŒƒå›´ã€ä¸‹æ‹‰é€‰é¡¹ï¼‰
- âŒ ä¸åŒç»„ä»¶å„è‡ªå®ç°é»˜è®¤å€¼é€»è¾‘ï¼Œä¸ä¸€è‡´
- âŒ ä¸‹æ‹‰ç±»å‹å…ƒç´ æ— æ³•æ·»åŠ é€‰é¡¹
- âŒ å…ƒç´ é»˜è®¤å€¼æ— æ³•è‡ªå®šä¹‰

### ç°åœ¨çš„ä¼˜åŠ¿
- âœ… å®Œæ•´çš„å…ƒç´ çº¦æŸé…ç½®ç•Œé¢
- âœ… ç»Ÿä¸€çš„é»˜è®¤å€¼å¤„ç†é€»è¾‘
- âœ… æ”¯æŒæ‰€æœ‰åŸºæœ¬ç±»å‹çš„çº¦æŸ
- âœ… ä¸‹æ‹‰å…ƒç´ å¯ä»¥é…ç½®é€‰é¡¹åˆ—è¡¨
- âœ… çº¦æŸé…ç½®åœ¨åˆå§‹åŒ–å’Œä¿å­˜æ—¶æ­£ç¡®å¤„ç†

---

## ğŸ”§ æŠ€æœ¯è¦ç‚¹

### é€’å½’é»˜è®¤å€¼ç”Ÿæˆ
```typescript
function getDefaultValue(field: IFieldDef): any {
  switch (field.type) {
    case 'array':
      if (fixedLength > 0) {
        // é€’å½’ç”Ÿæˆæ¯ä¸ªå…ƒç´ çš„é»˜è®¤å€¼
        return Array.from({ length: fixedLength }, () => 
          getDefaultValue(arrayField.element)
        );
      }
      return [];
    
    case 'object':
      const obj = {};
      objectField.properties.forEach(prop => {
        // é€’å½’ç”Ÿæˆæ¯ä¸ªå±æ€§çš„é»˜è®¤å€¼
        obj[prop.key] = getDefaultValue(prop);
      });
      return obj;
    
    // å…¶ä»–ç±»å‹...
  }
}
```

### çº¦æŸåº”ç”¨é€»è¾‘
```typescript
function applyElementConstraints(elementType, constraints) {
  const result = {};
  
  // åªæ·»åŠ å·²å®šä¹‰çš„çº¦æŸ
  if (constraints.defaultValue !== undefined) {
    result.defaultValue = constraints.defaultValue;
  }
  
  // ç±»å‹ç‰¹å®šçš„çº¦æŸ
  switch (elementType) {
    case 'number':
      if (constraints.min !== undefined) result.min = constraints.min;
      if (constraints.max !== undefined) result.max = constraints.max;
      // ...
      break;
    // å…¶ä»–ç±»å‹...
  }
  
  return result;
}
```

---

## ğŸ“ æµ‹è¯•å»ºè®®

### æµ‹è¯•ç”¨ä¾‹

1. **ä¸å®šé•¿æ•°å­—æ•°ç»„**
   - åˆ›å»ºæ•°ç»„å­—æ®µï¼Œå…ƒç´ ç±»å‹ä¸ºæ•°å­—
   - é…ç½®æœ€å°å€¼ 0ã€æœ€å¤§å€¼ 100ã€æ­¥é•¿ 10
   - æ·»åŠ æ•°æ®ï¼ŒéªŒè¯æ•°å­—è¾“å…¥æ¡†æœ‰æ­£ç¡®çš„çº¦æŸ

2. **å®šé•¿å¸ƒå°”æ•°ç»„**
   - åˆ›å»ºå›ºå®šé•¿åº¦ä¸º 5 çš„å¸ƒå°”æ•°ç»„
   - è®¾ç½®é»˜è®¤å€¼ä¸º true
   - éªŒè¯åˆå§‹åŒ–æ—¶è‡ªåŠ¨åˆ›å»º 5 ä¸ª true å€¼

3. **ä¸‹æ‹‰é€‰é¡¹æ•°ç»„**
   - åˆ›å»ºæ•°ç»„å­—æ®µï¼Œå…ƒç´ ç±»å‹ä¸ºä¸‹æ‹‰
   - æ·»åŠ  3 ä¸ªé€‰é¡¹
   - æ·»åŠ æ•°æ®ï¼ŒéªŒè¯æ¯ä¸ªå…ƒç´ æ˜¾ç¤ºä¸‹æ‹‰é€‰æ‹©

4. **åµŒå¥—æ•°ç»„**
   - åˆ›å»ºæ•°ç»„çš„æ•°ç»„ï¼ˆäºŒç»´æ•°ç»„ï¼‰
   - éªŒè¯åµŒå¥—ç¼–è¾‘å™¨æ­£å¸¸å·¥ä½œ

5. **ç¼–è¾‘å·²æœ‰å­—æ®µ**
   - åˆ›å»ºå¸¦çº¦æŸçš„æ•°ç»„å­—æ®µå¹¶ä¿å­˜
   - é‡æ–°ç¼–è¾‘è¯¥å­—æ®µ
   - éªŒè¯çº¦æŸé…ç½®æ­£ç¡®åŠ è½½

---

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡æ”¹è¿›å®ç°äº†ï¼š

1. **ç»Ÿä¸€çš„é»˜è®¤å€¼é€»è¾‘** - æ‰€æœ‰ç»„ä»¶ä½¿ç”¨åŒä¸€ä¸ªå‡½æ•°ï¼Œç¡®ä¿ä¸€è‡´æ€§
2. **å®Œå–„çš„å…ƒç´ çº¦æŸé…ç½®** - æ•°ç»„å…ƒç´ æ”¯æŒæ‰€æœ‰åŸºæœ¬ç±»å‹çš„çº¦æŸè®¾ç½®
3. **æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ** - æ¸…æ™°çš„é…ç½®ç•Œé¢ï¼Œåˆç†çš„é»˜è®¤å€¼è§„åˆ™
4. **ä»£ç è´¨é‡æå‡** - æ¶ˆé™¤é‡å¤ä»£ç ï¼Œæé«˜å¯ç»´æŠ¤æ€§

æ‰€æœ‰ä»£ç å‡å·²é€šè¿‡ç¼–è¯‘æ£€æŸ¥ï¼Œæ— é”™è¯¯ï¼ğŸŠ
