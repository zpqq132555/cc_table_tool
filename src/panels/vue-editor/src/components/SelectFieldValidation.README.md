# 下拉选择字段约束验证

## 问题
在编辑数据表时，如果数组类型的元素是下拉选择（select），可能没有配置选项，导致数据无法正常填入。

## 解决方案

### 1. 添加保存时验证

在 [FieldEditor.vue](../components/FieldEditor.vue) 的 `handleSave()` 函数中添加验证：

```typescript
// 验证下拉类型必须有选项
if (form.type === 'select' && typeConfig.options.length === 0) {
  alert('下拉类型字段至少需要一个选项');
  return;
}

// 验证数组元素类型为下拉时必须有选项
if (form.type === 'array' && typeConfig.elementType === 'select') {
  if (!typeConfig.elementConstraints.options || typeConfig.elementConstraints.options.length === 0) {
    alert('数组元素类型为下拉时，至少需要一个选项');
    return;
  }
}
```

### 2. 视觉提示改进

#### 选项列表标题
- 添加红色星号 `*` 标记必填项
- 当列表为空时显示

#### 空状态提示
- 原来：灰色文本 "暂无选项，请添加"
- 现在：橙色警告 "⚠️ 必须至少添加一个选项"
- 样式：橙色虚线边框 + 橙色背景高亮

### 3. CSS 样式

```css
.options-required {
  color: #ff9800;
  font-weight: 500;
  background: rgba(255, 152, 0, 0.1);
  border: 1px dashed #ff9800;
  border-radius: 4px;
}
```

## 影响范围

### 1. 字段类型为 select
- ✅ 必须至少添加一个选项才能保存
- ✅ 空状态时显示橙色警告
- ✅ 标题显示红色必填星号

### 2. 数组字段的元素类型为 select
- ✅ 必须至少添加一个选项才能保存
- ✅ 空状态时显示橙色警告
- ✅ 标题显示红色必填星号

## 用户体验

### 创建下拉字段流程

```
1. 选择字段类型：下拉 (select)
   ↓
2. 查看选项列表区域
   状态：⚠️ 必须至少添加一个选项 (橙色高亮)
   ↓
3. 点击 "➕ 添加选项"
   ↓
4. 填写选项内容
   ↓
5. 点击保存
   ✅ 验证通过，保存成功
```

### 如果未添加选项

```
1. 选择字段类型：下拉 (select)
   ↓
2. 不添加任何选项
   ↓
3. 点击保存
   ❌ 弹出提示："下拉类型字段至少需要一个选项"
   ❌ 无法保存
```

### 创建数组字段（元素为下拉）流程

```
1. 选择字段类型：数组 (array)
   ↓
2. 选择元素类型：下拉 (select)
   ↓
3. 查看元素约束区域的选项列表
   状态：⚠️ 必须至少添加一个选项 (橙色高亮)
   ↓
4. 点击 "➕ 添加选项"
   ↓
5. 填写选项内容
   ↓
6. 点击保存
   ✅ 验证通过，保存成功
```

## 测试场景

### 场景 1：创建下拉字段不添加选项
1. 创建新字段，类型选择 "下拉"
2. 不添加任何选项
3. 点击保存
4. **预期**：弹出提示 "下拉类型字段至少需要一个选项"

### 场景 2：创建数组字段，元素为下拉，不添加选项
1. 创建新字段，类型选择 "数组"
2. 元素类型选择 "下拉"
3. 不添加任何选项
4. 点击保存
5. **预期**：弹出提示 "数组元素类型为下拉时，至少需要一个选项"

### 场景 3：删除下拉字段的所有选项
1. 编辑已有下拉字段
2. 删除所有选项
3. 点击保存
4. **预期**：弹出提示 "下拉类型字段至少需要一个选项"

### 场景 4：正常添加选项
1. 创建下拉字段
2. 添加至少一个选项
3. 填写选项的显示文本和实际值
4. 点击保存
5. **预期**：保存成功

## 优势

1. **防止数据错误**：确保下拉字段总是有可选的值
2. **清晰的视觉反馈**：橙色警告醒目地提示用户
3. **即时验证**：保存时验证，防止无效配置
4. **一致性**：字段级别和数组元素级别的下拉都有相同的约束

## 技术细节

### 验证时机
- 用户点击保存按钮时
- 在 `handleSave()` 函数的最开始执行
- 在生成字段定义之前

### 验证逻辑
```typescript
// 检查字段类型
if (form.type === 'select' && typeConfig.options.length === 0) {
  // 验证失败
}

// 检查数组元素类型
if (form.type === 'array' && typeConfig.elementType === 'select') {
  if (!typeConfig.elementConstraints.options || 
      typeConfig.elementConstraints.options.length === 0) {
    // 验证失败
  }
}
```

### 样式实现
- 使用 Vue 条件渲染 `v-if` 动态显示必填星号
- 使用 CSS 类 `.options-required` 添加警告样式
- 橙色 (#ff9800) 作为警告色，区别于错误红色
