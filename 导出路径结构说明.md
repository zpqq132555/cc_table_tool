# 导出路径结构说明

## 功能概述

在 **standalone 模式**（浏览器开发环境）下，数据表导出时会按照以下结构组织文件：

### 单表导出结构
```
用户选择的根目录/
└── <数据源名>/              # .table 文件名（不含扩展名）
    ├── json/                # JSON 数据目录
    │   └── <exportPath>/    # 表的导出路径
    │       └── <tableKey>.json  # 数据文件
    └── ts/                  # TypeScript 声明文件目录（勾选"同步脚本"时生成）
        └── <exportPath>/    # 表的导出路径
            └── I<tableKey>.ts   # Interface 声明文件
```

### 批量导出结构
```
用户选择的根目录/
└── <数据源名>/
    ├── json/
    │   ├── <exportPath1>/<tableKey1>.json
    │   └── <exportPath2>/<tableKey2>.json
    └── ts/
        ├── <exportPath1>/I<tableKey1>.ts
        ├── <exportPath2>/I<tableKey2>.ts
        └── index.ts         # 统一导出索引（仅批量导出时生成）
```

## 示例

假设有一个数据源文件：
- **数据源文件**: `GameData.table`
- **表 Key**: `ItemConfig`
- **导出路径**: `config/item`

### 单表导出示例

用户选择根目录 `D:\Export\`，勾选"同步脚本"后导出：

```
D:\Export\
└── GameData\
    ├── json\
    │   └── config\
    │       └── item\
    │           └── ItemConfig.json
    └── ts\
        └── config\
            └── item\
                └── IItemConfig.ts
```

**注意**：单表导出不会生成 `index.ts`。

### 批量导出示例

点击主界面"📤 导出全部"按钮（需勾选"同步脚本"），导出多个表后：

```typescript
// D:\Export\GameData\ts\index.ts
export * from './config/item/IItemConfig';
export * from './config/skill/ISkillConfig';
export * from './player/IPlayerConfig';
```

## 实现细节

### 新增函数（standalone.ts）

1. **`exportTableWithStructure(dataSourceName, exportPath, tableKey, jsonData, tsData?)`**  
   单表结构化导出，支持自动创建嵌套目录
   - `dataSourceName`: 数据源名称（.table 文件名，不含扩展名）
   - `exportPath`: 表的导出路径
   - `tableKey`: 表的 key
   - `jsonData`: JSON 数据（ArrayBuffer）
   - `tsData`: TypeScript 声明文件数据（可选）

2. **`exportAllTablesWithStructure(dataSourceName, tables)`**  
   批量导出所有表，并自动生成 `index.ts` 统一导出文件
   - 会在 `<数据源名>/ts/index.ts` 生成统一导出索引

3. **`createNestedFileInDir(dirHandle, path, fileName, data)`**  
   递归创建目录并写入文件的内部工具函数

### 修改内容（DataEditor.vue）

- 修改了 `handleExport` 函数中的 standalone 分支
- 从 `dataManager.filePath` 提取数据源名（文件名，不含扩展名）
- 调用 `exportTableWithStructure` 时传入数据源名参数

### 修改内容（App.vue）

- 修改了 `handleExportAll` 函数中的 standalone 分支
- 使用 `exportAllTablesWithStructure` 实现批量结构化导出
- 自动生成 `index.ts` 统一导出索引
- **要求必须勾选"同步脚本"才能批量导出**

## 使用说明

### 单表导出

1. 在表管理界面创建表时，设置好**导出路径**（如 `config/item`）
2. 在数据编辑界面点击**导出数据**按钮
3. 勾选**同步脚本**开关（可选，用于生成 TypeScript 声明文件）
4. 浏览器会弹出目录选择对话框，选择根目录
5. 导出完成后，文件会按照 `<数据源名>/json/<exportPath>/` 和 `<数据源名>/ts/<exportPath>/`（勾选时）的结构保存

### 批量导出

1. 在主界面勾选**同步脚本**开关（批量导出必须勾选）
2. 点击**📤 导出全部**按钮
3. 浏览器会弹出目录选择对话框，选择根目录
4. 导出完成后，所有表按各自的 `exportPath` 组织文件结构
5. 自动在 `<数据源名>/ts/index.ts` 生成统一导出索引

## 注意事项

- 仅在 **standalone 模式**（浏览器环境）下生效
- 需要浏览器支持 **File System Access API**（Chrome 86+, Edge 86+）
- Cocos 编辑器模式仍使用原有的导出逻辑
- 导出路径支持多级目录（如 `config/item/weapon`）
- 数据源名自动从 .table 文件名提取
